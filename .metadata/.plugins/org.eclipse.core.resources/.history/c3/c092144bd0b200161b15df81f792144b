package theInfinityScore;

import java.util.ArrayList;

import ddf.minim.*;
import ddf.minim.ugens.*;
import processing.sound.SoundFile;

public class Singer {
	
	InfinityScore parent;
	Minim minim;
	Vocoder vocode;
	TextToSpeech tts;
	ArrayList<SoundFile> sf;
	ArrayList<Sampler> samples;
	Sampler testSampler;
	int numFiles;
	int currentPlace = 0;
	
	
//	public Singer(InfinityScore _parent, ArrayList<SoundFile> _lyrics){
//			parent = _parent;
//		  tts = new TextToSpeech();
//		  tts.setVoice("dfki-poppy-hsmm");
//		  tts.saveTTSfile("testing");
//		  lyrics = new ArrayList<SoundFile>();
//		  
//		  for (SoundFile sf : _lyrics){
//			  lyrics.add(sf);
//		  }		 	
//		
//	}
	
	public Singer(InfinityScore _parent){
		parent = _parent;
		minim = parent.minim;
		Vocoder vocode = new Vocoder(1024,8);
		sf = new ArrayList<SoundFile>();
		samples = new ArrayList<Sampler>();
		testSampler = new Sampler("1.wav", 4, minim);
	  tts = new TextToSpeech();
	  tts.setVoice("dfki-poppy-hsmm");
	  tts.saveTTSfile("testing");
	  //lyrics = new ArrayList<SoundFile>();
	  
	  //initSoundFiles();	 	
	
}
	
	public void realTimeReciteLyrics(String lyrics){
		tts.speak(lyrics, 1.0f, false, true);
	}
	
	public void recordSoundFiles(ArrayList<String> l){
		
		numFiles = l.size();
		if ( parent.verbose) System.out.println("recordSoundFiles: "+ numFiles + " is size of String Array List");
		for (int i = 0; i < l.size(); i++){
			tts.saveTTSfile(l.get(i), i);
			//tts.saveTTSfile(parent.libretto.headline);    //this would save the whole headline
			if (parent.verbose) System.out.println("recordSoundFiles: saved" + i);
		}
		initSoundFiles(numFiles);
	}
	
	public void playSoundFile(int index){
		SoundFile k = sf.get(index);
		k.play(0.25f);		
	}
	
	public void playSample(int index){

		Sampler s = samples.get(index);
		
		s.patch(parent.out);
		s.trigger();
	}
	

	
	public void singNext(){
		//playSoundFile(currentPlace);
		playSample(currentPlace);
		if (parent.verbose) System.out.println(currentPlace + " / " + sf.size() + " words in array" );
		int x = Die.getRoll(.75f, .25f);
		if( x == 1) currentPlace++;
		if(currentPlace >= sf.size()){
			currentPlace = (int)(Math.random()*sf.size());
		}
	}
	
	public void initSoundFiles(int num){
		//sf.clear();
		samples.clear();
		String path = parent.sketchPath + "/soundFiles/";
		if (parent.verbose) System.out.println(path + " is where we're searching for those files.");
		for(int i = 0; i < num; i ++){
		//SoundFile so= new SoundFile(parent, path + i + ".wav");
		Sampler sa = new Sampler(path + i + ".wav", 4, minim);
		sa.patch(parent.out);
		//sf.add(so);
		samples.add(sa);
		if (parent.verbose)System.out.println(samples.iterator()); 
		}
		if (parent.verbose) System.out.println("initSoundFiles: " + sf.size() + " is size of SoundFile arrayList");
	}
	
	public void patchVocoder(Sampler sx){
		sx.patch(vocode.modulator);
	}
	
	public void clearSoundFiles(){	
			sf.clear();	
			samples.clear();
			
	}
		
	

}
